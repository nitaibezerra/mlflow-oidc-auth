import{i as e,o as t,r as n,t as r}from"./button-DJ30HgDO.js";import{a as i,b as a,m as o,w as s}from"./free-solid-svg-icons-DA-2lxug.js";import{a as c,i as l,n as u,r as d}from"./create-api-fetcher-CIVcsK43.js";import"./toast-context-val-mhxutRO0.js";import{t as f}from"./page-container-Bc69w3xC.js";import{i as p,n as m,r as h,t as g}from"./search-input-B74H8nYS.js";import{t as _}from"./icon-button-B94rCe__.js";import{n as v,t as y}from"./use-toast-CTLGjzBn.js";import{t as b}from"./input-CjHmXOIG.js";import{t as x}from"./switch-C8sWYSoG.js";var S=t(e(),1);const C=u({endpointKey:`WEBHOOKS_RESOURCE`}),w=async e=>d(c.WEBHOOKS_RESOURCE,{method:`POST`,body:JSON.stringify(e)}),T=async(e,t)=>d(l.WEBHOOK_DETAILS(e),{method:`PUT`,body:JSON.stringify(t)}),E=async e=>d(l.WEBHOOK_DETAILS(e),{method:`DELETE`}),D=async(e,t)=>d(l.TEST_WEBHOOK(e),{method:`POST`,body:t?JSON.stringify(t):void 0});function O(){let[e,t]=(0,S.useState)([]),[n,r]=(0,S.useState)(!0),[i,a]=(0,S.useState)(null),o=(0,S.useCallback)(async(e=!1)=>{e||r(!0),a(null);try{t((await C()).webhooks)}catch(e){a(e instanceof Error?e:Error(String(e)))}finally{e||r(!1)}},[]);return(0,S.useEffect)(()=>{o()},[o]),{webhooks:e,isLoading:n,error:i,refresh:(0,S.useCallback)(()=>{o(!0)},[o]),updateLocalWebhook:(0,S.useCallback)((e,n)=>{t(t=>t.map(t=>t.webhook_id===e?{...t,status:n}:t))},[])}}const k=[{group:`Model Registry`,events:[`registered_model.created`,`model_version.created`,`model_version_tag.set`,`model_version_tag.deleted`,`model_version_alias.created`,`model_version_alias.deleted`]},{group:`Prompt Registry`,events:[`prompt.created`,`prompt_version.created`,`prompt_tag.set`,`prompt_tag.deleted`,`prompt_version_tag.set`,`prompt_version_tag.deleted`,`prompt_alias.created`,`prompt_alias.deleted`]}];var A=t(n(),1);const j=({initialData:e,onSubmit:t,onCancel:n,submitLabel:i,isSubmitting:a,isEdit:o=!1})=>{let[s,c]=(0,S.useState)(e||{name:``,url:``,events:[],secret:``}),[l,u]=(0,S.useState)({}),d=e=>{try{let t=e.trim(),n=new URL(t);return n.protocol===`http:`||n.protocol===`https:`}catch{return!1}},f=()=>{let e={};return s.name?.trim()||(e.name=`Name is required`),s.description&&s.description.length>500&&(e.description=`Description must be 500 characters or less`),s.url?.trim()?d(s.url)||(e.url=`Invalid URL format`):e.url=`URL is required`,(!s.events||s.events.length===0)&&(e.events=`At least one event must be selected`),u(e),Object.keys(e).length===0},p=e=>{c(t=>({...t,events:t.events?.includes(e)?t.events.filter(t=>t!==e):[...t.events||[],e]}))},m=e=>{e.preventDefault(),f()&&t(s)},h=o?`Updating...`:`Creating...`;return(0,A.jsxs)(`form`,{onSubmit:m,"aria-label":o?`Edit webhook form`:`Create webhook form`,children:[(0,A.jsx)(b,{label:`Name`,id:`webhook-name`,value:s.name||``,onChange:e=>c(t=>({...t,name:e.target.value})),error:l.name,required:!0,reserveErrorSpace:!0,containerClassName:`mb-2`}),(0,A.jsxs)(`div`,{className:`mb-2`,children:[(0,A.jsx)(`label`,{htmlFor:`webhook-description`,className:`block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1`,children:`Description`}),(0,A.jsx)(`textarea`,{id:`webhook-description`,value:s.description||``,onChange:e=>c(t=>({...t,description:e.target.value})),className:`w-full rounded-md border text-sm p-2 bg-ui-bg dark:bg-ui-bg-dark text-text-primary dark:text-text-primary-dark focus:ring-2 focus:ring-btn-primary focus:border-transparent ${l.description?`border-red-500 focus:ring-red-500`:`border-ui-border dark:border-ui-border-dark`}`,rows:3,placeholder:`Optional description (max 500 characters)`}),(0,A.jsx)(`p`,{className:`mt-1 text-sm ${l.description?`text-red-500`:`invisible`}`,children:l.description||`\xA0`})]}),(0,A.jsx)(b,{label:`URL`,id:`webhook-url`,value:s.url||``,onChange:e=>c(t=>({...t,url:e.target.value})),error:l.url,placeholder:`https://example.com/webhook`,required:!0,reserveErrorSpace:!0,containerClassName:`mb-2`}),(0,A.jsxs)(`div`,{className:`mb-2`,children:[(0,A.jsx)(`div`,{className:`block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1`,children:`Events*`}),(0,A.jsx)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4 border border-ui-border dark:border-ui-border-dark rounded-md p-4 max-h-40 overflow-y-auto`,children:k.map(e=>(0,A.jsxs)(`div`,{className:`space-y-2`,children:[(0,A.jsx)(`h5`,{className:`text-xs font-bold uppercase text-ui-text-muted dark:text-ui-text-muted-dark tracking-wider`,children:e.group}),e.events.map(e=>(0,A.jsxs)(`label`,{className:`flex items-center space-x-2 cursor-pointer group`,children:[(0,A.jsx)(`input`,{id:`event-${e}`,type:`checkbox`,className:`custom-checkbox w-4 h-4 rounded border-ui-border dark:border-ui-border-dark text-btn-primary focus:ring-btn-primary`,checked:s.events?.includes(e)||!1,onChange:()=>p(e)}),(0,A.jsx)(`span`,{className:`text-sm text-ui-text dark:text-ui-text-dark group-hover:text-btn-primary transition-colors`,children:e})]},e))]},e.group))}),(0,A.jsx)(`p`,{className:`mt-1 text-sm ${l.events?`text-red-500`:`invisible`}`,children:l.events||`\xA0`})]}),(0,A.jsx)(b,{label:`Secret (Optional)`,id:`webhook-secret`,value:s.secret||``,onChange:e=>c(t=>({...t,secret:e.target.value})),placeholder:o?`Leave empty to keep current secret`:`Webhook secret for HMAC verification`,reserveErrorSpace:!0,containerClassName:`mb-2`}),(0,A.jsxs)(`div`,{className:`flex justify-end space-x-3 pt-2`,children:[(0,A.jsx)(r,{type:`button`,onClick:n,variant:`ghost`,disabled:a,children:`Cancel`}),(0,A.jsx)(r,{type:`submit`,variant:`primary`,disabled:a,children:a?h:i})]})]})},M=({isOpen:e,onClose:t,onSuccess:n})=>{let{showToast:r}=y(),[i,a]=(0,S.useState)(!1);return(0,A.jsx)(v,{isOpen:e,onClose:t,title:`Create webhook`,children:(0,A.jsx)(j,{onSubmit:async e=>{a(!0);try{await w({...e,name:e.name.trim(),description:(e.description||``).trim(),url:e.url.trim(),secret:(e.secret||``).trim()}),r(`Webhook created successfully`,`success`),n(),t()}catch(e){console.error(`Failed to create webhook:`,e),r(`Failed to create webhook`,`error`)}finally{a(!1)}},onCancel:t,submitLabel:`Create`,isSubmitting:i},e?`open`:`closed`)})};function N(){let[e,t]=(0,S.useState)(!1),{showToast:n}=y();return{update:async(e,r,i)=>{t(!0);try{return await T(e,r),n(i.onSuccessMessage,`success`),!0}catch(e){return console.error(i.onErrorMessage,e),n(i.onErrorMessage,`error`),!1}finally{t(!1)}},isUpdating:e}}const P=({isOpen:e,onClose:t,onSuccess:n,webhook:r})=>{let{update:i,isUpdating:a}=N(),o=(0,S.useMemo)(()=>{if(r)return{name:r.name,description:r.description||``,url:r.url,events:[...r.events],secret:``}},[r]);return(0,A.jsx)(v,{isOpen:e,onClose:t,title:`Edit Webhook`,children:o&&(0,A.jsx)(j,{initialData:o,onSubmit:async e=>{if(!r)return;let a={name:e.name?.trim(),description:e.description?.trim(),url:e.url?.trim(),events:e.events};e.secret?.trim()&&(a.secret=e.secret.trim()),await i(r.webhook_id,a,{onSuccessMessage:`Webhook ${r.name} updated successfully`,onErrorMessage:`Failed to update Webhook ${r.name}`})&&(n(),t())},onCancel:t,submitLabel:`Update`,isSubmitting:a,isEdit:!0},r?.webhook_id)})},F=({isOpen:e,onClose:t,onConfirm:n,webhook:i,isProcessing:a})=>i?(0,A.jsx)(v,{isOpen:e,onClose:t,title:`Delete Webhook`,children:(0,A.jsxs)(`div`,{className:`text-ui-text dark:text-ui-text-dark`,children:[(0,A.jsxs)(`p`,{className:`mb-4`,children:[`The following webhook will be permanently deleted:`,` `,(0,A.jsx)(`span`,{className:`font-bold`,children:i.name}),`.`]}),(0,A.jsxs)(`div`,{className:`p-3 mb-6 space-y-2 text-sm`,children:[(0,A.jsxs)(`div`,{className:`flex`,children:[(0,A.jsx)(`span`,{className:`w-16 font-semibold opacity-70`,children:`ID:`}),(0,A.jsx)(`span`,{className:`font-mono`,children:i.webhook_id})]}),(0,A.jsxs)(`div`,{className:`flex`,children:[(0,A.jsx)(`span`,{className:`w-16 font-semibold opacity-70`,children:`URL:`}),(0,A.jsx)(`span`,{className:`truncate`,children:i.url})]})]}),(0,A.jsxs)(`div`,{className:`flex justify-end space-x-3`,children:[(0,A.jsx)(r,{variant:`ghost`,onClick:t,disabled:a,children:`Cancel`}),(0,A.jsx)(r,{variant:`danger`,onClick:n,disabled:a,children:a?`Deleting...`:`Delete Permanently`})]})]})}):null,I=({webhook:e,onSuccess:t})=>{let{update:n,isUpdating:r}=N(),[i,a]=(0,S.useState)(e.status===`ACTIVE`),[o,s]=(0,S.useState)(e.status);e.status!==o&&(s(e.status),a(e.status===`ACTIVE`));let c=async()=>{let r=i?`DISABLED`:`ACTIVE`;await n(e.webhook_id,{status:r},{onSuccessMessage:`Webhook ${r===`ACTIVE`?`enabled`:`disabled`} successfully`,onErrorMessage:`Failed to update webhook status`})&&(a(!i),t?.(r))};return(0,A.jsx)(x,{checked:i,onChange:()=>{c()},"aria-label":`${i?`Disable`:`Enable`} webhook`,disabled:r})};function L(){let{searchTerm:e,submittedTerm:t,handleInputChange:n,handleSearchSubmit:c,handleClearSearch:l}=p(),{webhooks:u,isLoading:d,error:v,refresh:b,updateLocalWebhook:x}=O(),{showToast:C}=y(),[w,T]=(0,S.useState)(!1),[k,j]=(0,S.useState)(null),[N,L]=(0,S.useState)(null),[R,z]=(0,S.useState)(!1),B=(0,S.useMemo)(()=>u.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())),[u,t]),V=(0,S.useCallback)(async(e,t)=>{try{let n=await D(e);n.success?C(`Test successful for ${t}`,`success`):C(`Test failed for ${t}: ${n.error_message||` Unknown error`}`,`error`)}catch(e){console.error(`Failed to test webhook:`,e),C(`Failed to test webhook ${t}`,`error`)}},[C]),H=(0,S.useCallback)(async()=>{if(N){z(!0);try{await E(N.webhook_id),C(`Webhook "${N.name}" deleted successfully`,`success`),b(),L(null)}catch(e){console.error(`Failed to delete webhook:`,e),C(`Failed to delete webhook "${N.name}"`,`error`)}finally{z(!1)}}},[N,b,C]),U=(0,S.useMemo)(()=>[{header:`Name`,render:e=>(0,A.jsx)(`span`,{className:`truncate block`,title:e.name,children:e.name})},{header:`Description`,render:e=>(0,A.jsx)(`span`,{className:`truncate block max-w-xs`,title:e.description||``,children:e.description||`-`})},{header:`URL`,render:e=>(0,A.jsx)(`span`,{className:`truncate block max-w-xs`,title:e.url,children:e.url})},{header:`Actions`,render:e=>(0,A.jsxs)(`div`,{className:`flex space-x-2`,children:[(0,A.jsx)(_,{icon:s,title:`Test`,onClick:()=>{V(e.webhook_id,e.name)}}),(0,A.jsx)(_,{icon:i,title:`Edit`,onClick:()=>j(e)}),(0,A.jsx)(_,{icon:a,title:`Delete`,onClick:()=>L(e)})]})},{header:`Active`,render:e=>(0,A.jsx)(I,{webhook:e,onSuccess:t=>x(e.webhook_id,t)})}],[V,x]);return(0,A.jsxs)(f,{title:`Webhooks`,children:[(0,A.jsx)(m,{isLoading:d,loadingText:`Loading webhooks...`,error:v,onRetry:b}),!d&&!v&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(`div`,{className:`mb-4 flex items-center gap-6`,children:[(0,A.jsx)(g,{value:e,onInputChange:n,onSubmit:c,onClear:l,placeholder:`Search webhooks...`}),(0,A.jsx)(r,{variant:`secondary`,onClick:()=>{T(!0)},icon:o,className:`whitespace-nowrap h-8 mb-1 mt-2`,children:`Add Webhook`})]}),(0,A.jsx)(h,{data:B,columns:U,searchTerm:t}),(0,A.jsx)(M,{isOpen:w,onClose:()=>T(!1),onSuccess:b}),(0,A.jsx)(P,{isOpen:!!k,onClose:()=>j(null),onSuccess:b,webhook:k}),(0,A.jsx)(F,{isOpen:!!N,onClose:()=>L(null),onConfirm:()=>{H()},webhook:N,isProcessing:R})]})]})}export{L as default};