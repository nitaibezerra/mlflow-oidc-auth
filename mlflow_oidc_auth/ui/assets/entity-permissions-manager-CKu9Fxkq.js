import{i as e,o as t,r as n,t as r}from"./button-DJ30HgDO.js";import{a as i,b as a}from"./free-solid-svg-icons-DA-2lxug.js";import{i as o,r as s}from"./create-api-fetcher-CIVcsK43.js";import{i as c,n as l,r as u,t as d}from"./search-input-B74H8nYS.js";import{t as f}from"./icon-button-B94rCe__.js";import{t as p}from"./use-toast-CTLGjzBn.js";import{n as m,t as h}from"./grant-permission-modal-BSY-HOl3.js";import{t as g}from"./use-all-users-CDNpVnIu.js";import{t as _}from"./use-all-accounts-6pNW8Jvr.js";import{t as v}from"./use-all-groups-CrID4Si4.js";var y=t(e(),1);function b({resourceId:e,resourceType:t,refresh:n}){let{showToast:r}=p(),[i,a]=(0,y.useState)(!1),[c,l]=(0,y.useState)(null),[u,d]=(0,y.useState)(!1);return{isModalOpen:i,editingItem:c,isSaving:u,handleEditClick:(0,y.useCallback)(e=>{l({name:e.name,permission:e.permission,kind:e.kind}),a(!0)},[]),handleSavePermission:(0,y.useCallback)(async i=>{if(c){d(!0);try{let u=``;t===`experiments`?u=c.kind===`group`?o.GROUP_EXPERIMENT_PERMISSION(c.name,e):o.USER_EXPERIMENT_PERMISSION(c.name,e):t===`models`?u=c.kind===`group`?o.GROUP_MODEL_PERMISSION(c.name,e):o.USER_MODEL_PERMISSION(c.name,e):t===`prompts`&&(u=c.kind===`group`?o.GROUP_PROMPT_PERMISSION(c.name,e):o.USER_PROMPT_PERMISSION(c.name,e)),await s(u,{method:`PATCH`,body:JSON.stringify({permission:i})}),r(`Permission for ${c.name} has been updated`,`success`),n(),a(!1),l(null)}catch{r(`Failed to update permission`,`error`)}finally{d(!1)}}},[c,e,t,n,r]),handleRemovePermission:(0,y.useCallback)(async i=>{try{let a=``;t===`experiments`?a=i.kind===`group`?o.GROUP_EXPERIMENT_PERMISSION(i.name,e):o.USER_EXPERIMENT_PERMISSION(i.name,e):t===`models`?a=i.kind===`group`?o.GROUP_MODEL_PERMISSION(i.name,e):o.USER_MODEL_PERMISSION(i.name,e):t===`prompts`&&(a=i.kind===`group`?o.GROUP_PROMPT_PERMISSION(i.name,e):o.USER_PROMPT_PERMISSION(i.name,e)),await s(a,{method:`DELETE`}),r(`Permission for ${i.name} has been removed`,`success`),n()}catch{r(`Failed to remove permission`,`error`)}},[e,t,n,r]),handleModalClose:(0,y.useCallback)(()=>{a(!1),l(null)},[]),handleGrantPermission:(0,y.useCallback)(async(i,a,c=`user`)=>{d(!0);try{let l=``;return t===`experiments`?l=c===`group`?o.GROUP_EXPERIMENT_PERMISSION(i,e):o.USER_EXPERIMENT_PERMISSION(i,e):t===`models`?l=c===`group`?o.GROUP_MODEL_PERMISSION(i,e):o.USER_MODEL_PERMISSION(i,e):t===`prompts`&&(l=c===`group`?o.GROUP_PROMPT_PERMISSION(i,e):o.USER_PROMPT_PERMISSION(i,e)),await s(l,{method:`POST`,body:JSON.stringify({permission:a})}),r(`Permission for ${i} has been granted`,`success`),n(),!0}catch{return r(`Failed to grant permission`,`error`),!1}finally{d(!1)}},[e,t,n,r])}}var x=t(n(),1);function S({resourceId:e,resourceName:t,resourceType:n,permissions:o,isLoading:s,error:p,refresh:S}){let{isModalOpen:C,editingItem:w,isSaving:T,handleEditClick:E,handleSavePermission:D,handleRemovePermission:O,handleModalClose:k,handleGrantPermission:A}=b({resourceId:e,resourceType:n,refresh:S}),{allUsers:j}=g(),{allServiceAccounts:M}=_(),{allGroups:N}=v(),[P,F]=(0,y.useState)(!1),[I,L]=(0,y.useState)(!1),[R,z]=(0,y.useState)(!1),B=new Set(o.map(e=>e.name)),V=(j||[]).filter(e=>!B.has(e)),H=(M||[]).filter(e=>!B.has(e)),U=(N||[]).filter(e=>!B.has(e)),{searchTerm:W,submittedTerm:G,handleInputChange:K,handleSearchSubmit:q,handleClearSearch:J}=c(),Y=o.filter(e=>e.name.toLowerCase().includes(G.toLowerCase()));return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(l,{isLoading:s,loadingText:`Loading permissions list...`,error:p,onRetry:S}),!s&&!p&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(`div`,{className:`flex items-center space-x-2 mb-4`,children:[(0,x.jsx)(r,{variant:`secondary`,onClick:()=>F(!0),disabled:V.length===0,title:V.length===0?`All users already have permissions`:`Add user permission`,children:`+ Add`}),(0,x.jsx)(r,{variant:`secondary`,onClick:()=>L(!0),disabled:H.length===0,title:H.length===0?`All service accounts already have permissions`:`Add service account permission`,children:`+ Add Service Account`}),(0,x.jsx)(r,{variant:`secondary`,onClick:()=>z(!0),disabled:U.length===0,title:U.length===0?`All groups already have permissions`:`Add group permission`,children:`+ Add Group`})]}),(0,x.jsx)(`div`,{className:`mb-2`,children:(0,x.jsx)(d,{value:W,onInputChange:K,onSubmit:q,onClear:J,placeholder:`Search permissions...`})}),(0,x.jsx)(u,{data:Y,columns:[{header:`Name`,render:e=>e.name},{header:`Permission`,render:e=>e.permission},{header:`Kind`,render:e=>e.kind},{header:`Actions`,render:e=>(0,x.jsxs)(`div`,{className:`flex space-x-2`,children:[(0,x.jsx)(f,{icon:i,title:`Edit permission`,onClick:()=>E(e)}),(0,x.jsx)(f,{icon:a,title:`Remove permission`,onClick:()=>void O(e)})]}),className:`w-24`}],searchTerm:G})]}),C&&w&&(0,x.jsx)(m,{isOpen:C,onClose:k,onSave:D,item:w,username:w?.name||``,resourceId:e,type:n,isLoading:T},w.name),P&&(0,x.jsx)(h,{isOpen:P,onClose:()=>F(!1),onSave:async(e,t)=>{await A(e,t)&&F(!1)},title:`Grant user permissions for ${t}`,label:`User`,options:V,isLoading:T}),I&&(0,x.jsx)(h,{isOpen:I,onClose:()=>L(!1),onSave:async(e,t)=>{await A(e,t)&&L(!1)},title:`Grant service account permissions for ${t}`,label:`Service account`,options:H,isLoading:T}),R&&(0,x.jsx)(h,{isOpen:R,onClose:()=>z(!1),onSave:async(e,t)=>{await A(e,t,`group`)&&z(!1)},title:`Grant group permissions for ${t}`,label:`Group`,options:U,isLoading:T})]})}export{S as t};