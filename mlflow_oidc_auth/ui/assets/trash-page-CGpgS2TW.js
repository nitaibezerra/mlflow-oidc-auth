import{i as e,o as t,r as n,t as r}from"./button-DJ30HgDO.js";import{n as i,s as a}from"./chunk-EPOLDU6W-BGm2xlSj.js";import"./use-runtime-config-CkwqDzno.js";import{t as o}from"./use-api-CtLXpHJw.js";import{b as s,x as c}from"./free-solid-svg-icons-DA-2lxug.js";import{a as l,i as u,n as d,r as f}from"./create-api-fetcher-CIVcsK43.js";import"./toast-context-val-mhxutRO0.js";import{t as p}from"./page-container-Bc69w3xC.js";import{i as m,n as h,r as g,t as _}from"./search-input-B74H8nYS.js";import{t as v}from"./icon-button-B94rCe__.js";import{n as y,t as b}from"./use-toast-CTLGjzBn.js";var x=t(e(),1);const S=d({endpointKey:`TRASH_EXPERIMENTS`,responseType:{deleted_experiments:[]}}),C=d({endpointKey:`TRASH_RUNS`,responseType:{deleted_runs:[]}}),w=async e=>f(l.TRASH_CLEANUP,{queryParams:e,method:`POST`}),T=async e=>f(u.RESTORE_EXPERIMENT(e),{method:`POST`}),E=async e=>f(u.RESTORE_RUN(e),{method:`POST`});function D(){let{data:e,isLoading:t,error:n,refetch:r}=o(S);return{deletedExperiments:e?.deleted_experiments||[],isLoading:t,error:n,refresh:r}}function O(){let{data:e,isLoading:t,error:n,refetch:r}=o(C);return{deletedRuns:e?.deleted_runs||[],isLoading:t,error:n,refresh:r}}var k=t(n(),1);const A=({isOpen:e,onClose:t,onConfirm:n,items:i,itemType:a,isProcessing:o})=>(0,k.jsx)(y,{isOpen:e,onClose:t,title:`Remove from trash`,children:(0,k.jsxs)(`div`,{className:`text-ui-text dark:text-ui-text-dark`,children:[(0,k.jsxs)(`p`,{className:`mb-4`,children:[`The following`,` `,a===`experiments`?`experiment(s)`:`run(s)`,` will be permanently deleted:`]}),(0,k.jsx)(`ul`,{className:`list-disc pl-5 max-h-60 overflow-y-auto mb-6 space-y-1`,children:i.map(e=>(0,k.jsxs)(`li`,{className:`text-sm`,children:[(0,k.jsx)(`span`,{className:`font-medium`,children:e.name}),` `,(0,k.jsxs)(`span`,{className:`text-ui-text-secondary dark:text-ui-text-secondary-dark`,children:[`(ID: `,e.id,`)`]})]},e.id))}),(0,k.jsxs)(`div`,{className:`flex justify-end space-x-3`,children:[(0,k.jsx)(r,{variant:`secondary`,onClick:t,children:`Cancel`}),(0,k.jsx)(r,{variant:`danger`,onClick:n,disabled:o,children:`Delete Permanently`})]})]})});function j(){let{tab:e}=a(),t=e===`runs`?`runs`:`experiments`,[n,o]=(0,x.useState)(()=>new Set),[l,u]=(0,x.useState)(!1),{showToast:d}=b(),[f,y]=(0,x.useState)(null);(0,x.useEffect)(()=>{o(new Set)},[t]);let{searchTerm:S,submittedTerm:C,handleInputChange:j,handleSearchSubmit:M,handleClearSearch:N}=m(),{deletedExperiments:P,isLoading:F,error:I,refresh:L}=D(),{deletedRuns:R,isLoading:z,error:B,refresh:V}=O(),H=t===`experiments`?F:z,U=t===`experiments`?I:B,W=t===`experiments`?L:V,G=(0,x.useMemo)(()=>t===`experiments`?(P||[]).map(e=>({id:e.experiment_id,name:e.name,creation:e.creation_time,lastUpdate:e.last_update_time,original:e,type:`experiments`})):(R||[]).map(e=>({id:e.run_id,name:e.run_name||`Run ${e.run_id}`,creation:e.start_time,lastUpdate:e.end_time,original:e,type:`runs`})),[t,P,R]),K=(0,x.useMemo)(()=>G.filter(e=>e.name.toLowerCase().includes(C.toLowerCase())),[G,C]),q=e=>{o(e?new Set(K.map(e=>e.id)):new Set)},J=(e,t)=>{let r=new Set(n);t?r.add(e):r.delete(e),o(r)},Y=async e=>{if(e.length!==0){u(!0);try{t===`experiments`?await Promise.all(e.map(e=>T(e))):await Promise.all(e.map(e=>E(e))),d(`Successfully restored ${e.length} item(s)`,`success`),o(new Set),W()}catch{d(`Failed to restore items`,`error`)}finally{u(!1)}}},X=e=>{e.length!==0&&y(G.filter(t=>e.includes(t.id)))},Z=async()=>{if(!f||f.length===0)return;u(!0);let e=f.map(e=>e.id);try{t===`experiments`?await w({experiment_ids:e.join(`,`)}):await w({run_ids:e.join(`,`)}),d(`Successfully deleted ${e.length} item(s)`,`success`),o(new Set),y(null),W()}catch{d(`Failed to delete items`,`error`)}finally{u(!1)}},Q=[{header:(0,k.jsx)(`div`,{className:`flex items-center justify-center`,children:(0,k.jsx)(`input`,{type:`checkbox`,className:`w-4 h-4 rounded custom-checkbox`,checked:K.length>0&&n.size===K.length,onChange:e=>q(e.target.checked)})}),id:`select`,render:e=>(0,k.jsx)(`div`,{className:`flex items-center justify-center`,children:(0,k.jsx)(`input`,{type:`checkbox`,className:`w-4 h-4 rounded custom-checkbox`,checked:n.has(e.id),onChange:t=>J(e.id,t.target.checked)})}),className:`w-8 m-[2px] flex-none`},{header:`Experiment ID`,render:e=>e.original.experiment_id},{header:`Name`,render:e=>(0,k.jsx)(`span`,{className:`truncate block`,title:e.name,children:e.name})},{header:`Creation`,render:e=>{let t=new Date(e.creation).toLocaleString();return(0,k.jsx)(`span`,{className:`truncate block`,title:t,children:t})}},{header:`Last Update`,render:e=>{let t=e.lastUpdate?new Date(e.lastUpdate).toLocaleString():`-`;return(0,k.jsx)(`span`,{className:`truncate block`,title:t,children:t})}},{header:`Actions`,render:e=>(0,k.jsxs)(`div`,{className:`flex space-x-2`,children:[(0,k.jsx)(v,{icon:c,title:`Restore`,onClick:()=>{Y([e.id])},disabled:l}),(0,k.jsx)(v,{icon:s,title:`Delete Permanently`,onClick:()=>{X([e.id])},disabled:l})]}),className:`w-24`}];return(0,k.jsxs)(p,{title:`Trash`,children:[(0,k.jsx)(`div`,{className:`flex justify-between items-center border-b border-btn-secondary-border dark:border-btn-secondary-border-dark mb-3`,children:(0,k.jsx)(`div`,{className:`flex space-x-4`,children:[{id:`experiments`,label:`Experiments`},{id:`runs`,label:`Runs`}].map(e=>(0,k.jsx)(i,{to:`/trash/${e.id}`,className:`py-2 px-4 border-b-2 font-medium text-sm transition-colors duration-200 ${t===e.id?`border-btn-primary text-btn-primary dark:border-btn-primary-dark dark:text-btn-primary-dark`:`border-transparent text-text-primary dark:text-text-primary-dark hover:text-text-primary-hover dark:hover:text-text-primary-hover-dark hover:border-btn-secondary-border dark:hover:border-btn-secondary-border-dark`}`,children:e.label},e.id))})}),(0,k.jsx)(h,{isLoading:H,loadingText:`Loading ${t}...`,error:U,onRetry:W}),!H&&!U&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(`div`,{className:`mt-2 mb-3 flex items-center justify-between gap-6`,children:[(0,k.jsx)(_,{value:S,onInputChange:j,onSubmit:M,onClear:N,placeholder:`Search ${t}...`}),(0,k.jsxs)(`div`,{className:`flex space-x-2`,children:[(0,k.jsx)(r,{variant:`secondary`,onClick:()=>{Y(Array.from(n))},disabled:n.size===0||l,children:`Restore`}),(0,k.jsx)(r,{variant:`danger`,onClick:()=>{X(Array.from(n))},disabled:n.size===0||l,children:`Delete`})]})]}),(0,k.jsx)(g,{data:K,columns:Q,searchTerm:C})]}),f&&(0,k.jsx)(A,{isOpen:!!f,onClose:()=>y(null),onConfirm:()=>{Z()},items:f,itemType:t,isProcessing:l})]})}export{j as default};